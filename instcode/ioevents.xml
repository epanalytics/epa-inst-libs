<!-- defines IO events that can be passed to a script that automaticaly generates
     headers and wrappers for them
  -->
  <!-- ioclass class=<IO type> # no data # -->
    <!-- function decl=<function name> ret=<return type> # no data # -->
      <!-- arg type=<C datatype> trace=<IOEvent_t struct entry> # <argument name> #-->
      <!-- custom location=<n in [0|1|2]> # some custom handling code (written in C) # -->
      <!-- trace dest=<IOEvent_t struct entry> # C expr # -->
      <!-- trace_hdr UNDEFINED # some data that gets put into the trace header #-->

<ioevents>

  <ioclass> MPIO
    <function ret="int"> MPI_File_open
      <arg type="MPI_Comm"> comm </arg>
      <arg type="char*" file="mpi"> filename </arg>
      <arg type="int"> amode </arg>
      <arg type="MPI_Info"> info </arg>
      <arg type="MPI_File*"> fh </arg>
      <trace dest="handle_id"> *fh </trace>
    </function>

    <function ret="int"> MPI_File_close
      <arg type="MPI_File*"> fh </arg>
      <custom location="0"> long int savef = *fh; </custom>
      <trace dest="handle_id"> savef </trace>
    </function>

    <function ret="int"> MPI_File_delete
      <arg type="char*" file="name"> filename </arg>
      <arg type="MPI_Info"> info </arg>
    </function>

    <function ret="int"> MPI_File_set_size
      <arg type="MPI_File" trace="handle_id"> fh </arg>
      <arg type="MPI_Offset" trace="offset"> size </arg>
    </function>

    <function ret="int"> MPI_File_preallocate
      <arg type="MPI_File" trace="handle_id"> fh </arg>
      <arg type="MPI_Offset" trace="offset"> size </arg>
    </function>

    <function ret="int"> MPI_File_set_view
      <custom location="0"> assert(0 &amp;&amp; "MPI_File_set_view is currently unhandled"); </custom>      
      <arg type="MPI_File" trace="handle_id"> fh </arg>
      <arg type="MPI_Offset"> disp </arg>
      <arg type="MPI_Datatype"> eype </arg>
      <arg type="MPI_Datatype"> filetype </arg>
      <arg type="char*"> datarep </arg>
      <arg type="MPI_Info"> info </arg>
    </function>

    <function ret="int"> MPI_File_read_at, MPI_File_read_at_all, MPI_File_write_at, MPI_File_write_at_all
      <arg type="MPI_File" trace="handle_id"> fh </arg>
      <arg type="MPI_Offset" trace="offset"> offset </arg>
      <arg type="void*"> buf </arg>
      <arg type="int"> count </arg>
      <arg type="MPI_Datatype" size="mpi_datatype"> datatype </arg>
      <trace dest="size"> (count * datasize) </trace>
      <arg type="MPI_Status*"> status </arg>
    </function>

    <function ret="int"> MPI_File_iread_at, MPI_File_iwrite_at
      <arg type="MPI_File" trace="handle_id"> fh </arg>
      <arg type="MPI_Offset" trace="offset"> offset </arg>
      <arg type="void*"> buf </arg>
      <arg type="int"> count </arg>
      <arg type="MPI_Datatype" size="mpi_datatype"> datatype </arg>
      <trace dest="size"> (count * datasize) </trace>
      <arg type="MPI_Request*"> request </arg>
    </function>

    <function ret="int"> MPI_File_iread, MPI_File_iwrite, MPI_File_iread_shared, MPI_File_iwrite_shared
      <arg type="MPI_File" trace="handle_id"> fh </arg>
      <arg type="void*"> buf </arg>
      <arg type="int"> count </arg>
      <arg type="MPI_Datatype" size="mpi_datatype"> datatype </arg>
      <trace dest="size"> (count * datasize) </trace>
      <arg type="MPI_Request*"> request </arg>
    </function>

    <function ret="int"> MPI_File_read, MPI_File_write, MPI_File_read_all, MPI_File_write_all, MPI_File_read_shared, MPI_File_write_shared, MPI_File_read_ordered, MPI_File_write_ordered
      <arg type="MPI_File" trace="handle_id"> fh </arg>
      <arg type="void*"> buf </arg>
      <arg type="int"> count </arg>
      <arg type="MPI_Datatype" size="mpi_datatype"> datatype </arg>
      <trace dest="size"> (count * datasize) </trace>
      <arg type="MPI_Status*"> status </arg>
    </function>

    <function ret="int"> MPI_File_seek, MPI_File_seek_shared
      <arg type="MPI_File" trace="handle_id"> fh </arg>
      <arg type="MPI_Offset" trace="offset"> offset </arg>
      <arg type="int"> whence </arg>
      <trace dest="offset_class"> offsetOriginToClass_MPIO(whence) </trace>
    </function>

    <function ret="int"> MPI_File_read_at_all_begin, MPI_File_write_at_all_begin
      <arg type="MPI_File" trace="handle_id"> fh </arg>
      <arg type="MPI_Offset" trace="offset"> offset </arg>
      <arg type="void*"> buf </arg>
      <arg type="int"> count </arg>
      <arg type="MPI_Datatype" size="mpi_datatype"> datatype </arg>
      <trace dest="size"> (count * datasize) </trace>
    </function>

    <function ret="int"> MPI_File_read_at_all_end, MPI_File_write_at_all_end
      <arg type="MPI_File" trace="handle_id"> fh </arg>
      <arg type="void*"> buf </arg>
      <arg type="MPI_Status*"> status </arg>
    </function>

    <function ret="int"> MPI_File_read_all_begin, MPI_File_write_all_begin, MPI_File_read_ordered_begin, MPI_File_write_ordered_begin
      <arg type="MPI_File" trace="handle_id"> fh </arg>
      <arg type="void*"> buf </arg>
      <arg type="int"> count </arg>
      <arg type="MPI_Datatype" size="mpi_datatype"> datatype </arg>
      <trace dest="size"> (count * datasize) </trace>
    </function>

    <function ret="int"> MPI_File_read_all_end, MPI_File_write_all_end, MPI_File_read_ordered_end, MPI_File_write_ordered_end
      <arg type="MPI_File" trace="handle_id"> fh </arg>
      <arg type="void*"> buf </arg>
      <arg type="MPI_Status*"> status </arg>
    </function>

    <function ret="int"> MPI_File_set_atomicity
      <custom location="0"> assert(0 &amp;&amp; "MPI_File_set_atomicity is currently unhandled"); </custom>      
      <arg type="MPI_File" trace="handle_id"> fh </arg>
      <arg type="int" trace="mode"> flag </arg>
    </function>

    <function ret="int"> MPI_File_sync
      <arg type="MPI_File" trace="handle_id"> fh </arg>
    </function>

  </ioclass>

  <ioclass> POSX
    <function ret="int"> chmod
      <arg type="const char*" file="name"> path </arg>
      <arg type="mode_t"> mode </arg>
    </function>

    <function ret="ssize_t"> write
      <arg type="int" trace="handle_id"> fd </arg>
      <arg type="const void*"> ptr </arg>
      <arg type="size_t" trace="size"> count </arg>
    </function>

    <function ret="ssize_t"> pwrite
      <arg type="int" trace="handle_id"> fd </arg>
      <arg type="const void*"> ptr </arg>
      <arg type="size_t" trace="size"> count </arg>
      <arg type="off_t" trace="offset"> offset </arg>
      <trace dest="offset_class"> IOOffset_SET </trace>
    </function>

<!-- breaks on 32bit, need to investigate
    <function ret="ssize_t" ifdef="__x86_64__"> pwrite64
    <function ret="ssize_t"> pwrite64
      <arg type="int" trace="handle_id"> fd </arg>
      <arg type="const void*"> ptr </arg>
      <arg type="size_t" trace="size"> count </arg>
      <arg type="off64_t" trace="offset"> offset </arg>
      <trace dest="offset_class"> IOOffset_SET </trace>
    </function>
-->

    <function ret="ssize_t"> pread
      <arg type="int" trace="handle_id"> fd </arg>
      <arg type="void*"> buf </arg>
      <arg type="size_t" trace="size"> count </arg>
      <arg type="off_t" trace="offset"> offset </arg>
      <trace dest="offset_class"> IOOffset_SET </trace>
    </function>

<!-- breaks on 32bit, need to investigate
    <function ret="ssize_t" ifdef="__x86_64__"> pread64
      <arg type="int" trace="handle_id"> fd </arg>
      <arg type="void*"> buf </arg>
      <arg type="size_t" trace="size"> count </arg>
      <arg type="off64_t" trace="offset"> offset </arg>
      <trace dest="offset_class"> IOOffset_SET </trace>
    </function>
-->

    <function ret="ssize_t"> read
      <arg type="int" trace="handle_id"> fd </arg>
      <arg type="void*"> buf </arg>
      <arg type="size_t" trace="size"> count </arg>
    </function>

    <function ret="int"> close
      <arg type="int"> fd </arg>
      <custom location="0"> long int savef = fd; </custom>
      <trace dest="handle_id"> savef </trace>
    </function>

    <function ret="int"> open, open64
      <arg type="const char*" file="handle"> filename </arg>
      <arg type="int"> mode </arg>
      <arg type="int"> flags </arg>
      <trace dest="handle_id"> retval </trace>
    </function>

    <function ret="int"> stat
      <arg type="const char*" file="name"> pathname </arg>
      <arg type="struct stat*"> buf </arg>
    </function>

    <function ret="int"> creat
      <arg type="const char*" file="handle"> filename </arg>
      <arg type="int"> flags </arg>
      <trace dest="handle_id"> retval </trace>
    </function>
  </ioclass>

  <ioclass> CLIB
<!--
    <function ret="int" variadic="vfprintf"> fprintf 
      <arg type="FILE*"> stream </arg>
      <arg type="const char*"> format </arg>
      <arg type=""> ... </arg>
    </function>
-->
    <function ret="int"> fseek
      <arg type="FILE*"> stream </arg>
      <arg type="long int" trace="offset"> offset </arg>
      <arg type="int"> origin </arg>
      <trace dest="offset_class"> offsetOriginToClass_CLIB(origin) </trace>
      <trace dest="handle_id"> getFileDescriptor(stream) </trace>
    </function>

    <function ret="size_t"> fwrite
      <arg type="const void*"> ptr </arg>
      <arg type="size_t"> size </arg>
      <arg type="size_t"> count </arg>
      <trace dest="size"> (size * count) </trace>
      <arg type="FILE*"> stream </arg>
      <trace dest="handle_id"> getFileDescriptor(stream) </trace>
    </function>

    <function ret="int"> fflush
      <arg type="FILE*"> stream </arg>
      <trace dest="handle_id"> getFileDescriptor(stream) </trace>
    </function>

    <function ret="FILE*"> fopen
      <arg type="const char*" file="handle"> filename </arg>
      <arg type="const char*"> mode </arg>
      <trace dest="handle_id"> getFileDescriptor(retval) </trace>
    </function>

    <function ret="int"> puts
      <arg type="const char*"> str </arg>
      <trace dest="size"> strlen(str) </trace>
      <trace dest="handle_id"> getFileDescriptor(stdout) </trace>
      <trace dest="handle_class"> IOHandle_CLIB </trace>
    </function>

    <function ret="int"> fclose
      <arg type="FILE*"> stream </arg>
      <custom location="0"> long int savef = getFileDescriptor(stream); </custom>
      <trace dest="handle_id"> savef </trace>
    </function>

    <function ret="size_t"> fread
      <arg type="void*"> ptr </arg>
      <arg type="size_t"> size </arg>
      <arg type="size_t"> count </arg>
      <trace dest="size"> (size * count) </trace>
      <arg type="FILE*"> stream </arg>
      <trace dest="handle_id"> getFileDescriptor(stream) </trace>
    </function>

    <function ret="int"> fstat
      <arg type="int" trace="handle_id"> fildes </arg>
      <arg type="struct stat*"> buf </arg>
    </function>

    <function ret="int"> fchmod
      <arg type="int" trace="handle_id"> fildes </arg>
      <arg type="mode_t"> mode </arg>
    </function>
  </ioclass>

</ioevents>
